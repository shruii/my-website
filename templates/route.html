<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Charging Stations - ChargeRoute</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&libraries=geometry"></script>
    <style>
        /* Custom marker icon for charging stations */
        .charging-icon {
            background-image: {{ url_for('static', filename='charging-station.png') }}", // Custom icon
            scaledSize: new google.maps.Size(32, 32), // Resize the icon
            background-size: cover;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
    <script>
        function initMap() {
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 7,
                center: { lat: {{ selected_route[0].lat }}, lng: {{ selected_route[0].lng }} }
            });

            // Plot all routes
            const routes = {{ routes | tojson }};
            routes.forEach((route, index) => {
                const routePath = new google.maps.Polyline({
                    path: route.route,
                    geodesic: true,
                    strokeColor: index === 0 ? "#4285F4" : "#FF0000",  // First route is blue, others are red
                    strokeOpacity: 1.0,
                    strokeWeight: 4,
                });
                routePath.setMap(map);
            });

            // Plot charging stations
            const stations = {{ stations | tojson }};
            const bounds = new google.maps.LatLngBounds();
            stations.forEach(station => {
                const latLng = new google.maps.LatLng(station.lat, station.lng);
                bounds.extend(latLng);

                // Custom marker for charging stations
                const marker = new google.maps.Marker({
                    position: latLng,
                    map: map,
                    icon: {
                        url: 'https://cdn-icons-png.flaticon.com/512/167/167755.png', // Replace with your custom icon
                        scaledSize: new google.maps.Size(32, 32), // Resize the icon
                    },
                    title: station.name,
                });

                // Add click event to redirect to Google Maps
                marker.addListener('click', () => {
                    window.open(`https://www.google.com/maps/search/?api=1&query=${station.lat},${station.lng}`, '_blank');
                });
            });
            map.fitBounds(bounds);
        }
    </script>
</head>
<body class="bg-gray-100" onload="initMap()">
    <header class="bg-white shadow-md py-4">
        <div class="container mx-auto flex justify-between items-center px-4">
            <h1 class="text-xl font-bold text-blue-500">ChargeRoute</h1>
        </div>
    </header>
    <main class="py-12">
        <div class="container mx-auto">
            <h2 class="text-center text-2xl font-bold">Route Details</h2>
            <p class="text-center mb-4">Estimated Range for Your Vehicle: {{ estimated_range }} km</p>
            <div id="map" style="height: 400px;" class="rounded-lg shadow-lg"></div>

            <!-- Display Charging Stations -->
            <h3 class="text-xl font-bold mt-8 mb-4">Charging Stations Along the Route</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for station in stations %}
                <div class="bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow">
                    <h4 class="font-bold text-lg">{{ station.name }}</h4>
                    <p class="text-sm text-gray-600 mt-2">{{ station.address }}</p>
                    <p class="text-sm text-gray-600 mt-1">Distance from Route: {{ station.distance }} km</p>
                    <p class="text-sm text-gray-600 mt-1">Rating: {{ station.rating }}</p>
                    <a href="https://www.google.com/maps/search/?api=1&query={{ station.lat }},{{ station.lng }}" target="_blank" class="mt-3 inline-block bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        View on Google Maps
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </main>
</body>
</html>